## Oracle PPAS 兼容性分析 之 伪列（ROWID）
---

### 一、背景介绍
ROWID是Oracle的一个伪列，返回数据库表每行的物理地址。主要包含4部分：
1. 数据对象编号（object_number）
2. 文件编号（relative_fno）
3. 块编号（block_number）
4. 行编号（row_number）

使用DBMS_ROWID包、函数ROWIDTOCHAR()和CHARTOROWID()进行常规操作。通常rowid值是可以唯一标示一行的。但集群中的不同表存储在一起，可能有相同的rowid。伪列ROWID包含2种数据类型：ROWID 或者 UROWID。

**注意：不建议使用rowid作为表的主键，因为的rowid的值在某些情况下是会发生变化的。**

+ 行记录被删除(DELETED)，然后再重新插入(RE-INSERTED)。
+ EXPORT/IMPORT 导出导入操作。
+ ALTER TABLE table_name MOVE; 命令。
+ 分区表的分区键值更新，导致记录在分区间移动。
+ ALTER TABLE table_name SHRINK SPACE COMPACT; 命令。
+ FLASHBACK TABLE table_name TO ... 命令。
+ COMPRESS 压缩操作。

**注意：行迁移和行链接 不会导致rowid发生变化。**
```
SQL> select d.*,rowid from scott.dept d where rownum=1;

    DEPTNO DNAME          LOC           ROWID
---------- -------------- ------------- ------------------
        10 ACCOUNTING     NEW YORK      AAAVRCAAEAAAACHAAA

SQL> 
```

PPAS/PG没有类似Oracle格式的rowid伪列，但是有系统列，如：OID、CTID等。其中CTID记录的是行号，由BLOCK_ID和ITEM_ID组成，即哪个数据块的哪条记录。和Oracle的rowid类似，只是形式不一样。通过都是用来做唯一性去重使用的。OID、CTID同样不是唯一的，可能会反生变化。同样可以使用OID来标示。
```
edb=# select t1.*,ctid from t1;
 id | name  |  ctid  
----+-------+--------
  1 | 1-t1  | (0,1)
  2 | 2-t1  | (0,2)
  3 | 3-t1  | (0,3)
  4 | 4-t1  | (0,4)
  5 | 5-t1  | (0,5)
  6 | 6-t1  | (0,6)
  7 | 7-t1  | (0,7)
  8 | 8-t1  | (0,8)
  9 | 9-t1  | (0,9)
 10 | 10-t1 | (0,10)
(10 rows)

edb=# 
```

### 二、转换规则



### 三、参考链接
1.[https://docs.oracle.com/database/121/SQLRF/pseudocolumns008.htm#SQLRF00254](https://docs.oracle.com/database/121/SQLRF/pseudocolumns008.htm#SQLRF00254)
2.[https://docs.oracle.com/database/121/ARPLS/d_rowid.htm#ARPLS67768](https://docs.oracle.com/database/121/ARPLS/d_rowid.htm#ARPLS67768)
3.[https://github.com/digoal/blog/blob/master/201711/20171108_01.md](https://github.com/digoal/blog/blob/master/201711/20171108_01.md)
